{"version":3,"sources":["webpack:///./ion-app.js","webpack:///../xin/components/app.js"],"names":["IonApp","classList","add","platformMode","platform","window","history","back","props","type","String","value","computed","define","xin","require","App","evt","console","error","detail","title","document","put","__appSignature","location","handlers","middlewares","__started","hashSeparator","reHashSeparator","RegExp","manual","async","start","pattern","match","str","chunks","split","length","Error","tokens","re","replace","g","token","push","optRe","slice","route","callback","routeHandler","args","__isStatic","result","__routeRegExp","__middlewareChainRun","compose","__execute","executed","info","__getId","__listenNavigation","fire","__executeCallback","mode","addEventListener","defaultPrevented","target","nodeName","preventDefault","state","url","getAttribute","pushState","innerHTML","href","bind","fragment","getFragment","reduce","executors","handler","forEach","name","index","getFragmentExecutors","context","uri","executor","path","options","rootUri","toString","origin","middleware","decodeURI","pathname","search","docTitle","observer","Boolean","Component","fn","TypeError","next","i","dispatch","module","exports"],"mappings":"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","file":"ion-app.js","sourcesContent":["import xin from 'xin';\nimport App from 'xin/components/app';\n\nclass IonApp extends App {\n  get props () {\n    let props = super.props;\n\n    props.platform = {\n      type: String,\n      value: 'android',\n    };\n\n    props.platformMode = {\n      type: String,\n      computed: '_computePlatformMode(platform)',\n    };\n\n    return props;\n  }\n\n  get listeners () {\n    return {\n      'backbutton': '_backButtonTapped',\n    };\n  }\n\n  ready () {\n    this.classList.add(this.platformMode);\n  }\n\n  _computePlatformMode (platform) {\n    return platform === 'android' ? 'md' : platform;\n  }\n\n  _backButtonTapped () {\n    window.history.back();\n  }\n}\n\nxin.define('ion-app', IonApp);\n\nexport default IonApp;\n\n\n\n/** WEBPACK FOOTER **\n ** ./ion-app.js\n **/","const xin = require('../src');\n\nclass App extends xin.Component {\n  get props () {\n    return {\n      docTitle: {\n        type: String,\n        value: 'Application',\n        observer: '_titleChanged',\n      },\n\n      manual: {\n        type: Boolean,\n      },\n\n      mode: {\n        type: String,\n        value: 'hash',\n      },\n\n      rootUri: {\n        type: String,\n        value: '/',\n      },\n\n      hashSeparator: {\n        type: String,\n        value: '#!',\n        observer: '_hashSeparatorChanged',\n      },\n    };\n  }\n\n  get listeners () {\n    return {\n      'route-not-found': 'handleRouteNotFound(evt)',\n    };\n  }\n\n  handleRouteNotFound (evt) {\n    console.error('Route not found: ' + evt.detail);\n  }\n\n  _titleChanged (title) {\n    document.title = title;\n  }\n\n  created () {\n    xin.put('app', this);\n\n    // this.classList.add('xin-app');\n\n    this.__appSignature = true;\n    this.location = window.location;\n    this.history = window.history;\n\n    // default values\n    this.handlers = [];\n    this.middlewares = [];\n\n    this.__started = false;\n  }\n\n  _hashSeparatorChanged (hashSeparator) {\n    this.reHashSeparator = new RegExp(hashSeparator + '(.*)$');\n  }\n\n  attached () {\n    if (!this.manual) {\n      this.async(this.start);\n    }\n  }\n\n  __isStatic (pattern) {\n    return !pattern.match(/[[{]/);\n  }\n\n  __routeRegExp (str) {\n    let chunks = str.split('[');\n\n    if (chunks.length > 2) {\n      throw new Error('Invalid use of optional params');\n    }\n\n    let tokens = [];\n    let re = chunks[0].replace(/{([^}]+)}/g, function (g, token) {\n      tokens.push(token);\n      return '([^/]+)';\n    }).replace(/\\//g, '\\\\/');\n\n    let optRe = '';\n\n    if (chunks[1]) {\n      optRe = '(?:' + chunks[1].slice(0, -1).replace(/{([^}]+)}/g, function (g, token) {\n        tokens.push(token);\n        return '([^/]+)';\n      }).replace(/\\//g, '\\\\/') + ')?';\n    }\n    return [ new RegExp('^' + re + optRe + '$'), tokens ];\n  }\n\n  route (route, callback) {\n    let routeHandler = {\n      route: route,\n      type: 's',\n      pattern: null,\n      args: [],\n      callback: callback,\n    };\n\n    if (!this.__isStatic(route)) {\n      let result = this.__routeRegExp(route);\n\n      routeHandler.type = 'v';\n      routeHandler.pattern = result[0];\n      routeHandler.args = result[1];\n    }\n\n    this.handlers.push(routeHandler);\n  }\n\n  async start () {\n    if (this.__started) {\n      return;\n    }\n\n    this.__middlewareChainRun = compose(this.middlewares);\n\n    // this.__starting = true;\n    let executed = await this.__execute();\n    // this.__starting = false;\n\n    if (executed) {\n      console.info(`Started    ${this.__getId()}`);\n\n      this.__started = true;\n\n      this.__listenNavigation();\n\n      this.fire('started');\n    }\n  }\n\n  __listenNavigation () {\n    let callback = this.__executeCallback = () => {\n      this.__execute();\n    };\n\n    if (this.mode === 'history') {\n      window.addEventListener('popstate', callback, false);\n      document.addEventListener('click', function (evt) {\n        if (!evt.defaultPrevented && evt.target.nodeName === 'A' && evt.target.target === '') {\n          evt.preventDefault();\n\n          let state = { url: evt.target.getAttribute('href') };\n          this.history.pushState(state, evt.target.innerHTML, evt.target.href);\n\n          callback();\n        }\n      }.bind(this));\n    } else {\n      window.addEventListener('hashchange', callback, false);\n    }\n  }\n\n  get started () {\n    return this.__started || false;\n  }\n\n  getFragmentExecutors (fragment) {\n    fragment = fragment || this.getFragment();\n\n    return this.handlers.reduce((executors, handler) => {\n      if (handler.type === 's') {\n        if (fragment === handler.route) {\n          executors.push({ handler: handler, args: {} });\n        }\n      } else if (handler.type === 'v') {\n        let result = fragment.match(handler.pattern);\n        if (result) {\n          let args = {};\n\n          handler.args.forEach(function (name, index) {\n            args[name] = result[index + 1];\n          });\n\n          executors.push({\n            handler: handler,\n            args: args,\n          });\n        }\n      }\n      return executors;\n    }, []);\n  }\n\n  async __execute () {\n    let fragment = this.getFragment();\n\n    let executors = this.getFragmentExecutors(fragment);\n    if (executors.length === 0) {\n      this.fire('route-not-found', fragment);\n      return false;\n    }\n\n    let context = { uri: fragment };\n\n    this.fire('navigated', context);\n\n    // run middleware chain then execute all executors\n    await this.__middlewareChainRun(context, () => {\n      executors.forEach(executor => executor.handler.callback(executor.args, context));\n    });\n\n    return true;\n  }\n\n  navigate (path, options) {\n    path = path || '/';\n    options = options || {};\n\n    if (this.mode === 'history') {\n      let url = this.rootUri + path.toString().replace(/\\/$/, '').replace(/^\\//, '');\n      if (this.location.href.replace(this.location.origin, '') !== url) {\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        this.__execute();\n      }\n    } else {\n      this.location.href.match(this.reHashSeparator);\n      this.location.href = this.location.href.replace(this.reHashSeparator, '') + this.hashSeparator + path;\n    }\n    return this;\n  }\n\n  use (middleware) {\n    this.middlewares.push(middleware);\n  }\n\n  getFragment () {\n    let fragment;\n    if (this.mode === 'history') {\n      fragment = decodeURI(this.location.pathname + this.location.search);\n      fragment = fragment.replace(/\\?(.*)$/, '');\n      fragment = this.rootUri === '/' ? fragment : fragment.replace(this.rootUri, '');\n    } else {\n      let match = this.location.href.match(this.reHashSeparator);\n      fragment = match ? match[1] : '';\n    }\n\n    return '/' + fragment.toString().replace(/\\/$/, '').replace(/^\\//, '');\n  }\n\n  // $back (evt) {\n  //   evt.preventDefault();\n  //   this.history.back();\n  // }\n}\n\nxin.define('xin-app', App);\n\nfunction compose (middlewares) {\n  for (const fn of middlewares) {\n    if (typeof fn !== 'function') {\n      throw new TypeError('Middleware must be composed of functions!');\n    }\n  }\n\n  return async (context, next) => {\n    // last called middlewares #\n    let index = -1;\n\n    async function dispatch (i) {\n      if (i <= index) {\n        throw new Error('next() called multiple times');\n      }\n\n      index = i;\n      let fn = middlewares[i];\n      if (i === middlewares.length) {\n        fn = next;\n      }\n      if (!fn) {\n        return;\n      }\n\n      return await fn(context, () => dispatch(i + 1));\n    }\n\n    return dispatch(0);\n  };\n}\n\nxin.App = App;\n\nmodule.exports = App;\n\n\n\n/** WEBPACK FOOTER **\n ** ../xin/components/app.js\n **/"],"sourceRoot":""}